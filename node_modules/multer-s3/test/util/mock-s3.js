var events = require('events')
<<<<<<< HEAD

function createMockS3 () {
  function send (opts, cb) {
    var ee = new events.EventEmitter()
    var buffer = opts['input']['Body']
    ee.emit('httpUploadProgress', { total: buffer.length })
    return Promise.resolve({
      Location: 'mock-location',
      ETag: 'mock-etag'
    })
  }

  return { send: send }
=======
var concat = require('concat-stream')

function createMockS3 () {
  function upload (opts) {
    var ee = new events.EventEmitter()

    ee.send = function send (cb) {
      opts['Body'].pipe(concat(function (body) {
        ee.emit('httpUploadProgress', { total: body.length })
        cb(null, {
          'Location': 'mock-location',
          'ETag': 'mock-etag'
        })
      }))
    }

    return ee
  }

  return { upload: upload }
>>>>>>> 8c4529f02c6a80e758c9f471359f61d0ece5e0a4
}

module.exports = createMockS3
